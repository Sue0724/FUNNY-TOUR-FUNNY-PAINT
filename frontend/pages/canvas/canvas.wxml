<!--pages/canvas/canvas.wxml-->
<view class="main">
  <map id="map" 
    subkey="{{subKey}}"
    latitude="{{latitude}}"
    longitude="{{longitude}}"
    scale="14"
    markers="{{markers}}"
    circles="{{circles}}"
    polyline="{{polylines}}"
    polygons="{{polygons}}"
    enable-3D="{{enable3d}}"
    show-location="{{showLocation}}"
    enable-zoom="{{enableZoom}}"
    enable-scroll="{{enableScroll}}"
    enable-overlooking="{{enableOverlooking}}"
    enable-satellite="{{enableSatellite}}"
    enable-traffic="{{enableTraffic}}"
    bindmarkertap="handleMarkerTap"
    bindregionchange="onMapMove"
  >
  </map>

  <!-- Canvas 透明层覆盖在地图上 -->
  <canvas type="2d" id="myCanvas" bindtouchstart="touchStart" bindtouchmove="touchMove" bindtouchend="touchEnd" style="pointer-events: {{drawMode ? 'all' : 'none'}};"></canvas>

  <!-- 边栏&画布工具栏 -->
  <view class="sidebar">
    <button bindtap="toggleDrawMode">{{drawMode ? '退出绘画模式' : '进入绘画模式'}}</button>
    <button bindtap="toggleShowNearbyPlaces">{{showNearbyPlaces ? '隐藏周边地点' : '显示周边地点'}}</button>
    <button bindtap="toggleHideDrawing">{{hideDrawing ? '显示绘画' : '隐藏绘画'}}</button>
    <button bindtap="clearCanvas">清空画布</button>
    <button bindtap="selectBrush" class="{{currentTool === 'brush' ? 'active' : ''}}">画笔</button>
    <button bindtap="selectEraser" class="{{currentTool === 'eraser' ? 'active' : ''}}">橡皮擦</button>
  </view>

  <!-- 移动控制按钮 -->
  <view class="sidebar2">
    <button bindlongpress="moveUp" bindtouchend="stopMove">上移</button>
    <button bindlongpress="moveDown" bindtouchend="stopMove">下移</button>
    <button bindlongpress="moveLeft" bindtouchend="stopMove">左移</button>
    <button bindlongpress="moveRight" bindtouchend="stopMove">右移</button>
  </view>

  <mp-halfScreenDialog show="{{showDialog}}" bindtap="onHideDialog">
    <view slot="title">{{currentMarker.name}}</view>
    <view slot="desc"></view>
    <view slot="footer">
      <button type="primary" class="weui-btn" bindtap="navi1">外部导航</button>
      <button type="primary" class="weui-btn" bindtap="navi2">内部导航</button>
    </view>
  </mp-halfScreenDialog>
</view>
